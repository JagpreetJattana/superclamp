/*!
 * Superclamp 0.1.0
 * https://github.com/makandra/superclamp
 */
(function(){var t,e,n,i,o,r,s,u,a,l,c,p,h,m,d,f,g,_,y,v,A,$,N,T,b,w,E,B=function(t,e){return function(){return t.apply(e,arguments)}},F=[].slice;a=!1,n=!1,c="superclamp:update",u="superclamp:instance",l="superclamp-ready",i="superclamp:dimensions",o="superclamp:distanceToBottomRight",r="superclamp:fragmentNodes",s="superclamp:fragmentValues",e=".clamp-ellipsis.is-not-required {\n  visibility: hidden !important;\n}\n.clamp-hidden {\n  display: none !important;\n}",t=window.jQuery,t("<style type='text/css'>"+e+"</style>").appendTo(document.head),t.fn.clamp=function(){return this.each(function(){return Superclamp.clamp(this)}),m()},t(function(){return t(document).on(c,Superclamp.reclampAll)}),this.Superclamp=function(){function e(e){var n;this.$element=e,this._clampNode=B(this._clampNode,this),this._checkFit=B(this._checkFit,this),this._unchanged=B(this._unchanged,this),this._distanceToBottomRight=B(this._distanceToBottomRight,this),this._getEllipsisAt=B(this._getEllipsisAt,this),this._clampThis=B(this._clampThis,this),this._storeDistance=B(this._storeDistance,this),this._updateElementAt=B(this._updateElementAt,this),p("initialize",this.$element),n=document.createTextNode(" "),this.$ellipsis=t('<span class="clamp-ellipsis">\u2026</span>'),this.$element.append(n,this.$ellipsis),E(this.$ellipsis),this.$element.data(u,this),this.$element.attr(l,!0)}return e.clamp=function(n){var i,o;return p(".clamp",n),i=t(n),o=i.data(u)||new e(i),o.clamp()},e.reclampAll=function(){var n,i,o,r;for(r=t("["+l+"]"),i=0,o=r.length;o>i;i++)n=r[i],e.clamp(n);return m()},e.prototype.clamp=function(){return T("query",function(t){return function(){return t._updateElementAt(),t._unchanged()?p("unchanged",t.$element):t._clampThis()}}(this))},e.prototype._updateElementAt=function(){return this.elementAt=_(this.$element)},e.prototype._storeDistance=function(){var t;return t=this._distanceToBottomRight(),p("storing distance",t),this.$ellipsis.data(o,t)},e.prototype._clampThis=function(){return N("_clampThis",this.$element),this._clampNode(this.$element.get(0),function(t){return function(e){return t._storeDistance(),T("layout",function(){return t.$ellipsis.toggleClass("is-not-required",e)})}}(this))},e.prototype._getEllipsisAt=function(){return y(this.$ellipsis)},e.prototype._distanceToBottomRight=function(){var t;return t=this._getEllipsisAt(),[this.elementAt.right-t.right,this.elementAt.bottom-t.bottom]},e.prototype._unchanged=function(){var t,e,n,i,r,s;return s=this.$ellipsis.data(o),null!=s?(t=s[0],n=s[1],r=this._distanceToBottomRight(),e=r[0],i=r[1],p("_unchanged: %o == %o && %o == %o",t,e,n,i),t===e&&n===i):!1},e.prototype._checkFit=function(t){return T("query",function(e){return function(){var n,i;return i=e._getEllipsisAt(),n=i.bottom<=e.elementAt.bottom&&i.right<=e.elementAt.right,p("checkFit: %o (bottom: %o <= %o, right: %o <= %o)",n,i.bottom,e.elementAt.bottom,i.right,e.elementAt.right),t(n)}}(this))},e.prototype._clampNode=function(e,n,i){var o,r;return null==i&&(i=!0),o=function(t){return function(i,s,u){return T("query",function(){var a,l,c;return p("findBestFit #contents: %o, nodeName: %o, prefix: %o",i,e.nodeName,s),0===i.length?n(u):1===i.length?r?(e.nodeValue=s+i[0],t._checkFit(function(t){return T("layout",function(i){return function(){return t?n(u):(e.nodeValue=s.replace(/ $/,""),n(!1))}}(this))})):t._clampNode(i[0],n,u):(l=Math.floor(i.length/2),a=i.slice(0,l),c=i.slice(l),p("findBestFit head: %o, tail: %o",a,c),r?e.nodeValue=s+a.join(" "):(w(a),v(c)),t._checkFit(function(t){return T("layout",function(n){return function(){return t?(p("fits"),r?o(c,e.nodeValue+" ",u):o(c,"",u)):(p("wont fit"),o(a,s,!1))}}(this))}))})}}(this),r="#text"===e.nodeName,T("layout",function(n){return function(){var s,u;return r?(A(e),o(g(e),"",i)):"#comment"!==e.nodeName?(s=t(e),w([s]),u=d(s),s.is(n.$element)&&(u=u.slice(0,-2)),o(u,"",i)):void 0}}(this))},e}(),$={layout:[],query:[]},T=function(t,e){return $[t].push(e)},h=function(t){var e,n;if(n=$[t],0===n.length)return!0;for(p("draining",t);e=n.shift();)e();return!1},m=function(){var t,e,n;for(n=[];!t||!e;)t=h("layout"),n.push(e=h("query"));return n},p=function(){var t,e;return t=1<=arguments.length?F.call(arguments,0):[],n&&null!=(e=window.console)&&"function"==typeof e.debug?e.debug.apply(e,t):void 0},N=function(){var t,e;return t=1<=arguments.length?F.call(arguments,0):[],a&&null!=(e=window.console)&&"function"==typeof e.log?e.log.apply(e,t):void 0},E=function(t){var e,n;return e=t.height(),n=t.width(),t.data(i,[n,e]),p("storeDimensions",n,e)},y=function(t){var e,n,o,r;return o=t.data(i)||[t.width(),t.height()],r=o[0],e=o[1],n={top:t.prop("offsetTop"),left:t.prop("offsetLeft")},null==n.bottom&&(n.bottom=n.top+e),null==n.right&&(n.right=n.left+r),p("getPosition of %o: %o",t,n),n},_=function(t){var e;return e={top:t.prop("offsetTop"),left:t.prop("offsetLeft")},e.top+=parseInt(t.css("padding-top")),e.left+=parseInt(t.css("padding-left")),e.bottom=e.top+t.height(),e.right=e.left+t.width(),e},f=function(e){var n,i,o,u;return n=t(e.parentNode),o=n.data(r)||[],u=n.data(s)||[],i=t.inArray(e,o),[o,u,i,n]},b=function(t,e){var n,i,o,u,a;return u=f(t),o=u[0],a=u[1],i=u[2],n=u[3],0>i&&(i=o.length),o[i]=t,a[i]=e,n.data(r,o),n.data(s,a),e},g=function(t){var e,n,i,o,r;return o=f(t),i=o[0],r=o[1],n=o[2],e=o[3],r[n]},A=function(t){return null==g(t)&&b(t,t.nodeValue.split(/\s+/)),t},d=function(e){return t.makeArray(e.get(0).childNodes)},v=function(e){var n,i,o,r;for(r=[],n=0,i=e.length;i>n;n++)o=e[n],"#text"===o.nodeName?(A(o),r.push(o.nodeValue="")):r.push(t(o).addClass("clamp-hidden"));return r},w=function(e){var n,i,o,r,s;for(s=[],i=0,o=e.length;o>i;i++)r=e[i],"#text"===r.nodeName?(A(r),s.push(r.nodeValue=g(r).join(" "))):(n=t(r),n.removeClass("clamp-hidden"),s.push(w(d(n))));return s}}).call(this);